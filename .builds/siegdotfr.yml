image: alpine/edge
packages:
  - nodejs
  - npm
secrets:
  - b281abe1-aa13-4d4d-aa44-7caae701052e
  - bb73991e-d834-4685-928e-d277eef2a0b2
sources:
  - git@git.sr.ht:~siegfriedehret/sites
tasks:
  - check-branch:
      if [ "$(cd sites && git rev-parse HEAD)" != "$(cd sites && git rev-parse origin/main)" ]; then complete-build; fi
  - deploy: |
      set +x
      . ~/.buildsecrets
      cd sites
      npx vercel --prod --token "$VERCEL_TOKEN"

image: alpine/edge
packages:
  - nodejs
  - npm
secrets:
  - b281abe1-aa13-4d4d-aa44-7caae701052e
  - 5249ccc1-6ab0-4a74-a551-f4d0e277600c
sources:
  - git@git.sr.ht:~siegfriedehret/sites
tasks:
  - check-branch:
      if [ "$(cd sites && git rev-parse HEAD)" != "$(cd sites && git rev-parse origin/main)" ]; then complete-build; fi
  - deploy: |
      set +x
      . ~/.buildsecrets
      cd sites
      npx vercel --prod --token "$VERCEL_TOKEN"

---
import { formatDate } from '@packages/utils/date';
import { convert } from '@packages/utils/content';
import { useTranslations } from '@packages/utils/i18n';
import type { Language } from '@packages/utils/i18n';
import Figure from '../Figure.astro';
import Toc from '../Toc.astro';

const { story, lang = 'en' } = Astro.props;
const post = {
	title: story.name,
	image: story.content.image || {},
	date: formatDate(story.first_published_at),
	updatedAt: formatDate(story.published_at),
	...(await convert(story.content.content as string))
};

const t = useTranslations(lang as Language);
---

<nav>
	<a href={t('post.all-notes-link')}>&lt;= {t('post.all-notes')}</a>
</nav>

<section>
	<h1>{post.title}</h1>

	{post.image.filename && <Figure url={post.image.filename} title={post.image.alt} />}

	<details>
		<summary>{post.date}</summary>
		{t('post.last-modified')}
		{post.updatedAt}
	</details>
	{post.headings && <Toc headings={post.headings} />}

	<Fragment set:html={post.html} />
</section>

<style>
	details {
		margin-bottom: 1rem;
		font-size: var(--fs-small);
	}
	summary {
		text-decoration: underline;
		cursor: pointer;
	}
</style>
